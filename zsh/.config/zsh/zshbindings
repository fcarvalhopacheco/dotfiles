#!/usr/bin/env zsh
#
#████████████████████████████████████████████████████████████████████████████
#
#
#       ██████╗ ██╗███╗   ██╗██████╗ ██╗███╗   ██╗ ██████╗ ███████╗
#       ██╔══██╗██║████╗  ██║██╔══██╗██║████╗  ██║██╔════╝ ██╔════╝
#       ██████╔╝██║██╔██╗ ██║██║  ██║██║██╔██╗ ██║██║  ███╗███████╗
#       ██╔══██╗██║██║╚██╗██║██║  ██║██║██║╚██╗██║██║   ██║╚════██║
#       ██████╔╝██║██║ ╚████║██████╔╝██║██║ ╚████║╚██████╔╝███████║
#       ╚═════╝ ╚═╝╚═╝  ╚═══╝╚═════╝ ╚═╝╚═╝  ╚═══╝ ╚═════╝ ╚══════╝
#
#    GitHub:  https://github.com/fcarvalhopacheco
#
#    References:
#       - https://www.strcat.de/dotfiles/
#       - https://github.com/Phantas0s/.dotfiles/blob/master/zsh/completion.zsh
#
#
#   This script is based on code from https://github.com/zap-zsh/vim, 
#   which is licensed under the GNU GPL v3.0. The original code can be 
#   found at:  https://github.com/zap-zsh/vim/blob/master/vim.plugin.zsh
#   
#
#████████████████████████████████████████████████████████████████████████████


# Set up Vi mode key bindings
bindkey -v
export KEYTIMEOUT=1

if [[ -o menucomplete ]]; then 
    # Use hjlk in menu selection (during completion)
    bindkey -M menuselect 'h' vi-backward-char
    bindkey -M menuselect 'k' vi-up-line-or-history
    bindkey -M menuselect 'j' vi-down-line-or-history
    bindkey -M menuselect 'l' vi-forward-char
    bindkey -M menuselect 'i' accept-and-menu-complete
    bindkey -M menuselect 'o' accept-and-infer-next-history
    bindkey -M menuselect '^d' clear-screen
    bindkey -M menuselect 'u' undo                           # Undo
fi

# Change cursor shape for different vi modes.
function zle-keymap-select () {
    case $KEYMAP in
        vicmd) echo -ne '\e[1 q';;      # block
        viins|main) echo -ne '\e[5 q';; # beam
    esac
}

zle -N zle-keymap-select

zle-line-init() {
    zle -K viins # initiate `vi insert` as keymap (can be removed if `bindkey -V` has been set elsewhere)
    echo -ne "\e[5 q"
}

zle -N zle-line-init

echo -ne '\e[5 q' # Use beam shape cursor on startup.

preexec() { 
    echo -ne '\e[5 q' 
} 











